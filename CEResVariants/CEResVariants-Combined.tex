\section{A Combined Approach}
\label{sec:Combination}

Although the number of defined symbols introduced by the construction of
definitional clause sets is bounded linearly with respect to the size of the
characteristic formula, it still creates a new symbol for every subformula of
the characteristic formula. The number of new symbols can be reduced with a
technique that combines ideas from swapped and definitional clause sets. The
idea is to use $\normalizePlusTimesS$ as long as no duplications occur and
then use $\normalizePlusTimesD$ only for the subformulas that cannot be
normalized with $\normalizePlusTimesS$ without duplications.


\begin{definition}[$\normalizePlusTimesSD$]
\label{definition:NormalizationPlusTimesDefinitionalSwap}
$\normalizePlusTimesSDs$ denotes a restricted form of $\normalizePlusTimesS$ where the distribution of disjunction over conjunction cannot lead to duplications. The first rewriting rule from Definition \ref{definition:NormalizationPlusTimesSwap} is replaced by the rewriting rule below, where $\hF{S}$ is distributed to at most one conjunct $\hF{S_k}$:
$$
\hF{S} \hF{\structtimes} (S_1 \structplus \ldots \structplus \hF{S_k} \structplus \ldots \structplus S_n) \normalizePlusTimesSDs  S_1 \structplus \ldots \structplus (\hF{S} \hF{\structtimes} \hF{S_{k}}) \structplus \ldots \structplus S_n
$$

\noindent
$\normalizePlusTimesSDd$ denotes a restricted form of $\normalizePlusTimesD$, defined by the following rewriting rule, which can be applied only if $S \vee (S_1 \structplus \ldots \structplus S_n)$ is already in $\normalizePlusTimesSD$-normal-form:
\begin{small}
$$
C[S \vee (S_1 \structplus \ldots \structplus S_n)]   
\normalizePlusTimesSDd 
C[S \vee N(x_1,\ldots, x_m)] \structplus (N(x_1,\ldots, x_m) \biimp S_1 \structplus \ldots \structplus S_n)
$$
\end{small}
where $N$ is a new symbol and $x_1, \ldots, x_m$ are free-variables of $(S_1 \structplus \ldots \structplus S_n)$.

\medskip
\noindent
The relation $\normalizePlusTimesSD$ is the union of $\normalizePlusTimesSDs$ and $\normalizePlusTimesSDd$.
\end{definition}

\begin{definition}[Definitional Swapped Clause Set]
\label{definition:CutPertinentClauseSetSwappeDefinitional}
A \emph{definitional swapped clause set} $\clausesetSwapDef{\varphi}{S}$ of a proof $\varphi$ w.r.t. to a $\normalizePlusTimesSD$-normal-form $S$ of $\struct{\varphi}$ is $S$ written in sequent notation.
Clauses originating from defining equations introduced by $\normalizePlusTimesSDd$ are \emph{definitional clauses}. Non-definitional clauses not containing new symbols are \emph{pure clauses}. All other clauses are \emph{mixed clauses}.
\end{definition}

\begin{remark}
In cases where $\clausesetSwapDef{\varphi}{S_1} = \clausesetSwapDef{\varphi}{S_2}$ for any $S_1$ and $S_2$, the unique definitional swapped clause set is denoted simply as $\clausesetSwapDefUnique{\varphi}$.
\end{remark}



\begin{example}
\label{example:PlusTimesSwappeDefinitionalNormalization}
Let $\varphi$ be the proof shown in Example \ref{example:PlusTimesSwapNormalization}.
Its characteristic formula can be normalized as follows:
$$
\begin{array}{rcl}
\struct{\varphi} 
& \equiv &
((\hA{A} \structplus^1 \hB{B}) \structplus^3 (\hC{\structdual{B}} \structtimes^2 \hD{\structdual{A}}))
\structtimes^5
(\hE{C} \structplus^4 \hF{\structdual{C}}) \\
%
& \normalizePlusTimesSDs &
	((\hA{A} \structplus^1 \hB{B})\structtimes^5 (\hE{C} \structplus^4 \hF{\structdual{C}}))
\structplus^3 
	(\hC{\structdual{B}} \structtimes^2 \hD{\structdual{A}}) \\
%
& \normalizePlusTimesSDs &
	((((\hA{A} \structplus^1 \hB{B})\structtimes^5 \hE{C}) \structplus^4 \hF{\structdual{C}}))
\structplus^3 
	(\hC{\structdual{B}} \structtimes^2 \hD{\structdual{A}}) \\
%
& \normalizePlusTimesSDd &
	(((D_{\hA{A} \structplus \hB{B}} \structtimes^5 \hE{C}) \structplus^4 \hF{\structdual{C}}))
\structplus^3 
	(\hC{\structdual{B}} \structtimes^2 \hD{\structdual{A}}) 
\structplus
(D_{\hA{A} \structplus \hB{B}} \biimp (\hA{A} \structplus^1 \hB{B})) \\
%
& \equiv &
	(D_{\hA{A} \structplus \hB{B}} \structtimes^5 \hE{C}) 
\structplus^4 
	\hF{\structdual{C}}
\structplus^3 
	(\hC{\structdual{B}} \structtimes^2 \hD{\structdual{A}}) 
\structplus \\
&		   &	
	(\neg D_{\hA{A} \structplus \hB{B}} \structtimes \hA{A} ) 
\structplus
	(\neg D_{\hA{A} \structplus \hB{B}} \structtimes \hB{B} )
\structplus
	(D_{\hA{A} \structplus \hB{B}} \structtimes (\neg \hA{A} \structtimes \neg \hB{B})) \\
\end{array}
$$

\noindent
And the corresponding definitional swapped clause set is:
$$
\clausesetSwapDefUnique{\varphi} \equiv  \left\{ \begin{array}{l}
	\seq D_{\hA{A} \structplus \hB{B}} , \hE{C} 
\ \ \ ; \\
	\hF{C} \seq 
\ \ \ ; \\
	\hC{B} , \hD{A} \seq
\ \ \ ; \\
	D_{\hA{A} \structplus \hB{B}} \seq \hA{A}  
\ \ \ ; \\
	D_{\hA{A} \structplus \hB{B}} \seq \hB{B} 
\ \ \ ; \\
	\hA{A}, \hB{B} \seq D_{\hA{A} \structplus \hB{B}} 
\end{array} \right\}
$$

\noindent
$D_{\hA{A} \structplus \hB{B}} \seq \hA{A}$, $D_{\hA{A} \structplus \hB{B}} \seq \hB{B}$ 
and $\hA{A}, \hB{B} \seq D_{\hA{A} \structplus \hB{B}}$ are definitional clauses. 
$\hF{C} \seq $ and 
$\hC{B} , \hD{A} \seq$ are pure clauses. 
And $\seq D_{\hA{A} \structplus \hB{B}} , \hE{C}$ is a mixed clause.
\hfill\QED
\end{example}


\noindent 
While construction of definitional swapped clause sets is reasonably
straightforward, the construction of projections presents some difficulties.
As in the case of definitional clause sets, some clauses in definitional
swapped clause sets are definitional, and their projections can be easily
constructed according to Definition \ref{definition:DProjectionDefinitional}.
Other clauses are pure in the sense that they do not contain any defined
predicate symbol, and hence their projections can be constructed with the
usual method explained in Definition \ref{definition:OProjection}. However,
for mixed clauses, which contain a mix of defined and undefined predicate
symbols, it is necessary to construct a \emph{mixed projection}, which
combines the usual algorithm with the construction method for proper 
projections described in Definition \ref{definition:DProjectionProper}.



\begin{definition}[Encapsulated Formulas]
\label{definition:EncapsulatedFormulaOccurrences} Let $S$ be a characteristic
formula and $S'$ be a subformula of $S$ corresponding to a new predicate
symbol $N_{S'}$ created during the $\normalizePlusTimesSD$-normalization of
$S$. Then, the \emph{encapsulated formulas} of $N_{S'}$ are all the atomic
formulas of $S'$. 
\end{definition}

\begin{example} 
\label{example:EncapsulatedFormulaOccurrences} 
The formulas encapsulated by the new predicate symbol 
$D_{\hA{A} \structplus \hB{B}}$ of the $\normalizePlusTimesSD$-normal-form 
of the struct $\struct{\varphi}$ shown
in Example \ref{example:PlusTimesSwappeDefinitionalNormalization} are:
$\hA{A}$ and $\hB{B}$. 
\hfill\QED 
\end{example}


\begin{definition}[Mixed Projection]
\label{definition:DWProjectionMixed}
Let $\varphi$ be a proof and $c$ a mixed clause in $\clausesetSwapDef{\varphi}{S}$.
The \emph{mixed projection} $\projectionMixed{\varphi}{c}$ of $\varphi$ w.r.t. $c$ is constructed in two steps:
\begin{enumerate}
\item Apply the usual algorithm from Definition \ref{definition:OProjection} to $\varphi$, letting $A$ be the set of axioms that contain formulas that contribute to $c$ or that are encapsulated by a new predicate symbol in $c$.
%
\item Replace inferences operating on descendants of encapsulated formulas by $\neg_r$, $\wedge_r$, $\vee_r$ and $d_r$, analogously to what is done in the construction of proper projections (Definition \ref{definition:DProjectionProper}).
\end{enumerate}
\end{definition}


\begin{example}
\label{example:DWProjectionMixed}
Let $\varphi$ be the proof from previous examples. Noting that the axiom sequent $\hE{C} \seq \hE{C}$ contains a formula that directly contributes to $\seq D_{\hA{A} \structplus \hB{B}} , \hE{C}$, while the axiom sequents $\hA{A} \seq \hA{A}$ and $\hB{B} \seq \hB{B}$ contain formulas that are encapsulated by $D_{\hA{A} \structplus \hB{B}}$, the first step in the construction of the mixed 
projection $\projectionMixed{\varphi}{\seq D_{\hA{A} \structplus \hB{B}} , \hE{C}}$generates the following proof:
%
\begin{prooftree}
\AXC{$\hA{A} \seq \hA{A} $}
		\AXC{$\hB{B} \seq \hB{B}$} \RightLabel{$\wedge_r^1$}
	\BIC{$\hA{A}, \hB{B} \seq \hA{A} \wedge \hB{B}$} \RightLabel{$\wedge_l$}
	\UIC{$\hA{A} \wedge \hB{B} \seq \hA{A} \wedge \hB{B}$}
								\AXC{$\hE{C} \seq \hE{C}$} \RightLabel{$\vee_l^5$}
					\BIC{$(\hA{A} \wedge \hB{B}) \vee \hE{C} \seq \hA{A} \wedge \hB{B}, \hE{C} $} 
\end{prooftree}
%

\noindent
The second step introduces definition inferences to reencapsulate the formulas:
\begin{prooftree}
\AXC{$\hA{A} \seq \hA{A} $}
		\AXC{$\hB{B} \seq \hB{B}$} \RightLabel{$\wedge_r$}
	\BIC{$\hA{A}, \hB{B} \seq \hA{A} \wedge \hB{B}$} \RightLabel{$d_r$}
	\UIC{$\hA{A}, \hB{B} \seq D_{\hA{A} \structplus \hB{B}}$} \RightLabel{$\wedge_l$}
	\UIC{$\hA{A} \wedge \hB{B} \seq D_{\hA{A} \structplus \hB{B}}$}
							\AXC{$\hE{C} \seq \hE{C}$} \RightLabel{$\vee_l^5$}
					\BIC{$(\hA{A} \wedge \hB{B}) \vee \hE{C} \seq D_{\hA{A} \structplus \hB{B}}, \hE{C} $} 
\end{prooftree}
\hfill\QED
\end{example}

\begin{definition}[$\CEResDS$-normal-form]
$\CEResNFDS{\varphi}{\delta}$ denotes the \emph{$\CEResDS$ normal-form} of the proof $\varphi$ w.r.t. the resolution refutation $\delta$ of any definitional swapped clause set $\clausesetSwapDef{\varphi}{S}$. It is obtained in the same way as a $\CERes$-normal-form, but using a definitional swapped clause set $\clausesetSwapDef{\varphi}{S}$ instead of $\clauseset{\varphi}$ and using definitional and mixed projections when necessary.
\end{definition}

\begin{example}
The shortest refutation $\delta$ of $\clausesetSwapDefUnique{\varphi}$ is shown below:
\begin{prooftree}
\AXC{$\seq D_{\hA{A} \structplus \hB{B}} , \hE{C}$}
		\AXC{$\hF{C} \seq$} \RightLabel{$r$}
	\BIC{$\seq D_{\hA{A} \structplus \hB{B}}$}
				\AXC{$D_{\hA{A} \structplus \hB{B}} \seq \hA{A}$}
						\AXC{$D_{\hA{A} \structplus \hB{B}} \seq \hB{B}$}
								\AXC{$\hC{B} , \hD{A} \seq$} \RightLabel{$r$}
							\BIC{$D_{\hA{A} \structplus \hB{B}}, \hD{A} \seq $} \RightLabel{$r$}
					\BIC{$D_{\hA{A} \structplus \hB{B}}, D_{\hA{A} \structplus \hB{B}} \seq $} \RightLabel{$f_l$}
					\UIC{$D_{\hA{A} \structplus \hB{B}} \seq $} \RightLabel{$r$}
			\BIC{$ \seq $}
\end{prooftree}

\noindent
Using the mixed projection shown in Example \ref{example:DWProjectionMixed}, 
pure projections shown in Example \ref{example:OProjections} and definitional
projections shown in Example \ref{example:DProjectionDefinitional}, 
$\CEResNFDS{\varphi}{\delta}$ is:
\begin{tiny}
\begin{prooftree}
	\AXC{$\projectionMixed{\varphi}{\seq D_{\hA{A} \structplus \hB{B}} , \hE{C}}$}
               		\AXC{$\hF{C} \seq \hF{C}$} \RightLabel{$cut$}
               	\BIC{$(\hA{A} \wedge \hB{B}) \vee \hE{C} \seq D_{\hA{A} \structplus \hB{B}}, \hF{C}$}
	            				\AXC{$\hA{A} \seq \hA{A}$} \RightLabel{$w_l$}
               				\UIC{$\hA{A}, \hB{B} \seq \hA{A}$} \RightLabel{$\wedge_l$}
               				\UIC{$\hA{A} \wedge \hB{B} \seq \hA{A}$} \RightLabel{$d_l$}
               				\UIC{$D_{\hA{A} \structplus \hB{B}} \seq \hA{A}$}
               						\AXC{$\hB{B} \seq \hB{B}$} \RightLabel{$w_l$}
               						\UIC{$\hA{A}, \hB{B} \seq \hB{B}$} \RightLabel{$\wedge_l$}
               						\UIC{$\hA{A} \wedge \hB{B} \seq \hB{B}$} \RightLabel{$d_l$}
               						\UIC{$D_{\hA{A} \structplus \hB{B}} \seq \hB{B}$}
               								\AXC{$\hC{B} \seq \hC{B} $}
															\AXC{$\hD{A} \seq \hD{A}$} \RightLabel{$\wedge_r$}
														\BIC{$ \hC{B}, \hD{A} \seq \hC{B} \wedge \hD{A}$} \RightLabel{$cut$}
               							\BIC{$D_{\hA{A} \structplus \hB{B}}, \hD{A} \seq \hC{B} \wedge \hD{A}$} \RightLabel{$cut$}
               					\BIC{$D_{\hA{A} \structplus \hB{B}}, D_{\hA{A} \structplus \hB{B}} \seq \hC{B} \wedge \hD{A}$} \RightLabel{$c_l$}
               					\UIC{$D_{\hA{A} \structplus \hB{B}} \seq \hC{B} \wedge \hD{A}$} \RightLabel{$cut$}
               			\BIC{$(\hA{A} \wedge \hB{B}) \vee \hE{C} \seq \hC{B} \wedge \hD{A}, \hF{C}$}
\end{prooftree}
\end{tiny}
\hfill\QED
\end{example}

